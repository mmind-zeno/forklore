services:
  webapp:
    build: ./webapp
    ports:
      - "3001:3000"
    restart: unless-stopped
    volumes:
      - recipes-db:/app/prisma
      - recipes-uploads:/app/uploads
    environment:
      - NODE_ENV=production
      - DATABASE_URL=file:/app/prisma/dev.db
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - ADMIN_PASSWORD=${ADMIN_PASSWORD}
      - NEXTAUTH_SECRET=${NEXTAUTH_SECRET}
      - NEXTAUTH_URL=${NEXTAUTH_URL}
    deploy:
      resources:
        limits:
          memory: 512M
          cpus: "0.5"

volumes:
  recipes-db:
  recipes-uploads:
